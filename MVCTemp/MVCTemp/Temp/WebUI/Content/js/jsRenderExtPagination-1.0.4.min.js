(function($){var _MVC_PagerCallBack=null;var _MVC_PagerPagerSuccess=null;$.extend({pagination:function(data,pageIndex,history){var domErr="<div id='_MVC_ERROR_INFO'></div>";var config={url:"",pageSize:20,templateId:"",updateId:"",data:null,callBack:null,pagerId:"",isHistory:true,pagerSuccess:null};$.extend(config,data);if(pageIndex===undefined||pageIndex===""||parseInt(pageIndex)<=0){pageIndex=1}if(typeof pageIndex==="string"){pageIndex=parseInt(pageIndex,10)}if(!(typeof config.data==="object")){layer.alert("data,请传入json对象!");return}if(config.templateId===""){layer.alert("请传入表格模版Id!");return}if(config.updateId===""){layer.alert("请传入表格修改块ID!");return}$.ajax({url:config.url+"?pageIndex="+pageIndex+"&pageSize="+config.pageSize,data:config.data,type:!config.type?"get":config.type,cache:false,beforeSend:function(){layer.load(0,2,true,"查询中...")},success:function(result){layer.loadClose();if(history!==1&&config.isHistory){var state={},callBack=config.callBack||_MVC_PagerCallBack,pagerSuccess=config.pagerSuccess||_MVC_PagerPagerSuccess,callBackCookieName="HISTORY_STATE_OPTION_CALLBACK",pagerSuccessCookieName="HISTORY_STATE_OPTION_PAGERSUCCESS",callBackSubCount=0,pagerSuccessSubCount=0;state.pageIndex=pageIndex;state.options={};$.extend(state.options,config);if(callBack!=null){state.options.callBack=callBack.toString()}if(pagerSuccess!=null){state.options.pagerSuccess=pagerSuccess.toString()}History.pushState(state,document.title,location.href.split("#")[0]+"#pageIndex="+pageIndex);var insertCookie=function(cookieName,cookieString,cookieLen,cookieCount){if(cookieLen>2000){for(var i=0;i<cookieCount;i++){if(i===0){$.cookie(cookieName+i,cookieString.substr(i*2000,2000))}else{$.cookie(cookieName+i,cookieString.substr(i*2000+1,2000))}}}else{$.cookie(cookieName+"0",cookieString)}};if(!ISSUPPORT&&!$.cookie("HISTORY_STATE_OPTION")){if(callBack!=null){var callBackString=callBack.toString().replace(/\;/g,"_HISTORY_SEMICOLON_").replace(/\+/g,"_HISTORY_ADD_").replace(/\r/g,"").replace(/\n/g,"").replace(/\t/g,""),callBackLen=callBackString.length;callBackSubCount=Math.ceil(callBackLen/2000);insertCookie(callBackCookieName,callBackString,callBackLen,callBackSubCount);state.options.callBackSubCount=callBackSubCount;state.options.callBackCookieName=callBackCookieName}if(pagerSuccess!=null){var pagerSuccessString=pagerSuccess.toString().replace(/\;/g,"_HISTORY_SEMICOLON_").replace(/\+/g,"_HISTORY_ADD_").replace(/\r/g,"").replace(/\n/g,"").replace(/\t/g,""),pagerSuccessLen=pagerSuccessString.length;pagerSuccessSubCount=Math.ceil(pagerSuccessLen/2000);insertCookie(pagerSuccessCookieName,pagerSuccessString,pagerSuccessLen,pagerSuccessSubCount);state.options.pagerSuccessSubCount=pagerSuccessSubCount;state.options.pagerSuccessCookieName=pagerSuccessCookieName}delete state.options.callBack;delete state.options.pagerSuccess;$.cookie("HISTORY_STATE_OPTION",JSON.stringify(state.options).replace(/\r/g,"").replace(/\n/g,"").replace(/\t/g,""))}}var resData=null,pageTotalCount=0,pageCount=1,HasPreviousPage=false,HasNextPage=false;if(!result){return}try{resData=JSON.parse(result.replace(/\r/g,"").replace(/\n/g,""))}catch(ex){try{resData=eval("("+result.replace(/\r/g,"").replace(/\n/g,"")+")")}catch(ex){$("body").append($(domErr).clone().html(result));var i=$.layer({type:1,area:["auto","auto"],border:[10,0.3,"#000",true],title:["错误",true],closeBtn:["0",true],page:{dom:"#_MVC_ERROR_INFO"}});return}}if(resData.code!==undefined&&resData.code!==1){layer.alert(resData.message);$("#"+config.updateId+"").html("");if(config.pagerId!==""){$("#"+config.pagerId).html("");$("."+config.pagerId).html("")}else{$("#pagerJSRender").html("");$(".pagerJSRender").html("")}return}if(typeof config.callBack==="function"){resData=config.callBack(resData);_MVC_PagerCallBack=config.callBack}else{if(typeof _MVC_PagerCallBack==="function"){resData=_MVC_PagerCallBack(resData)}}try{pageTotalCount=parseInt(resData.totalCount,10)}catch(ex){try{pageTotalCount=parseInt(resData[0].totalCount,10)}catch(ex){$("body").append($(domErr).clone().html(result));var i=$.layer({type:1,area:["auto","auto"],border:[10,0.3,"#000",true],title:["错误",true],closeBtn:["0",true],page:{dom:"#_MVC_ERROR_INFO"}});return}}pageCount=Math.ceil(pageTotalCount/config.pageSize);if(pageCount<=0){$("#"+config.updateId+"").html("");if(config.pagerId!==""){$("#"+config.pagerId).html("");$("."+config.pagerId).html("")}else{$("#pagerJSRender").html("");$(".pagerJSRender").html("")}}pageIndex=pageIndex>pageCount?pageCount:pageIndex;if(!(pageIndex==1)){HasPreviousPage=true}if(!(pageIndex===pageCount)){HasNextPage=true}var commonBackData=JSON.stringify(config);var tempData={data:commonBackData,PageSize:config.pageSize,HasPreviousPage:HasPreviousPage,HasNextPage:HasNextPage,CurrentPage:pageIndex>pageCount?pageCount:pageIndex,PageCount:pageCount,PageTotalCount:pageTotalCount};$("#"+config.updateId+"").html($("#"+config.templateId+"").render(resData));$.getScript("http://rs.517na.com/js/common/paginationTemp/jsRenderPager.js",function(){if(config.pagerId!==""){if(pageCount>0){$("#"+config.pagerId).html($.render.pager(tempData));$("."+config.pagerId).html($.render.pager(tempData))}if(typeof config.pagerSuccess==="function"){config.pagerSuccess();_MVC_PagerPagerSuccess=config.pagerSuccess}else{if(typeof _MVC_PagerPagerSuccess==="function"){_MVC_PagerPagerSuccess()}}}else{if(pageCount>0){$("#pagerJSRender").html($.render.pager(tempData));$(".pagerJSRender").html($.render.pager(tempData))}if(typeof config.pagerSuccess==="function"){config.pagerSuccess(resData);_MVC_PagerPagerSuccess=config.pagerSuccess}else{if(typeof _MVC_PagerPagerSuccess==="function"){_MVC_PagerPagerSuccess(resData)}}}})},error:function(ex){layer.loadClose();if(ex){layer.alert("查询错误",true,"信息",function(index){layer.close(index)})}}})}})})(jQuery);(function(d,f){d.ISSUPPORT=!!(d.history&&history.pushState);d.IS_FIRST_LOAD=true;var c=0,e=0;d.History={state:{},pushState:null,replaceState:null,popState:null};var a=function(){if(!e){if(typeof History.popState=="function"){History.popState()}}else{e=0}};if(ISSUPPORT){History.pushState=function(k,l,j){d.history.pushState(k,l,j)};History.replaceState=function(k,l,j){d.history.replaceState(k,l,j)};if(d.addEventListener){d.addEventListener("popstate",a,false)}else{d.attachEvent("onpopstate",a)}}else{var i=(i=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase()))?{type:"ie",version:i[1]}:null;var b=!!("onhashchange" in d)&&!(i.type=="ie"&&(i.version<8||f.documentMode<8));var g={set:function(j){d.location.hash=j},get:function(){return d.location.hash}};History.pushState=function(k,l,j){History.state['"'+c+++'"']=k;f.title=l;if(b){e=1;g.set(j.split("#")[1])}};if(b){if(d.addEventListener){d.addEventListener("hashchange",a,false)}else{d.attachEvent("onhashchange",a)}}}var h={getCookieValue:function(m,l){var j="";if(l>0){for(var k=0;k<l;k++){j+=$.cookie(m+k).replace(/_HISTORY_SEMICOLON_/g,";").replace(/_HISTORY_ADD_/g,"+")}}else{j=$.cookie(m+"0").replace(/_HISTORY_SEMICOLON_/g,";").replace(/_HISTORY_ADD_/g,"+")}return j},returnFunction:function(j){if(j.callBack){j.callBack=(new Function("return "+j.callBack))()}if(j.pagerSuccess){j.pagerSuccess=(new Function("return "+j.pagerSuccess))()}},pagination:function(j){h.returnFunction(j.options);$.pagination(j.options,j.pageIndex,1)},isEmptyObject:function(k){for(var j in k){return false}return true}};History.popState=function(){if(ISSUPPORT){if(history.state){h.pagination(history.state);if(IS_FIRST_LOAD){IS_FIRST_LOAD=false}}else{if(!IS_FIRST_LOAD){location.reload()}else{IS_FIRST_LOAD=false}}}else{if(!h.isEmptyObject(History.state)){if(location.hash){var m=-1;for(var l in History.state){m+=1}if(m){h.pagination(History.state['"'+ --m+'"']);delete History.state['"'+m+'"']}}else{location.reload()}}else{if($.cookie("HISTORY_STATE_OPTION")){if(location.hash){var j=location.hash.substring(11),k=JSON.parse($.cookie("HISTORY_STATE_OPTION"));if(k.callBackSubCount!=null){k.callBack=h.getCookieValue(k.callBackCookieName,k.callBackSubCount)}if(k.pagerSuccessSubCount!=null){k.pagerSuccess=h.getCookieValue(k.pagerSuccessCookieName,k.pagerSuccessSubCount)}h.returnFunction(k);$.pagination(k,j,1)}else{location.reload()}}}}};$(f).ready(function(){if(ISSUPPORT){if(history.state){h.pagination(history.state)}}else{if($.cookie("HISTORY_STATE_OPTION")){if(location.hash){var j=location.hash.substring(11),k=JSON.parse($.cookie("HISTORY_STATE_OPTION"));if(k.callBackSubCount!=null){k.callBack=h.getCookieValue(k.callBackCookieName,k.callBackSubCount)}if(k.pagerSuccessSubCount!=null){k.pagerSuccess=h.getCookieValue(k.pagerSuccessCookieName,k.pagerSuccessSubCount)}h.returnFunction(k);$.pagination(k,j,1)}}}})})(window,document);